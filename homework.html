<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>作业</title>
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="bootstrap/css/user.css">
    <script src="js/jquery.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/getUrlParam.js"></script>
    <script src="js/common.js"></script>
    <!-- 异步提交的库 -->
    <script src="js/vue-resource.js"></script>

    <script>
        $(function(){
            get_token();
            show_homework();
        });
    </script>
</head>
<body>

    <div id = "homework" >我的作业：</div>

</body>

<script>
    function get_token(){
        var token = localStorage.getItem("token");
    }

    function create_homework_div(homework){
        homework = JSON.parse(homework);
        html = "";
        html += "<div>内容：<br>";
        task = homework['task'];
        console.log(task);
        for (var i = 0, n = task.length;i<n;i++){
            for (var j = 0;j<4;j++) {
                html += "&nbsp;";
            }
            html+=task[i];
            html+="<br>";
        }
        html += "<div><br>";

        html += "<div>分数：";
        score = homework['score'];
        html += score.toString();
        html += "<div><br>";


        html += "<div>开始时间：";
        t = homework['start_time'];
        t = new Date(t*1000);
        t = dateFormat("YYYY-mm-dd HH:MM",t);
        html += t;
        html += "<div><br>";

        html += "<div>结束时间：";
        t = homework['finish_time'];
        t = new Date(t*1000);
        t = dateFormat("YYYY-mm-dd HH:MM",t);
        html += t;
        html += "<div><br>";



        return html;
    }

    function show_homework(){
        var course_id = UrlParam.paramValues('cid');
        course_id = course_id[0];
        var homeworks = get_homework(course_id);
        console.log(homeworks);
        var liObj = document.createElement("li");
        tempHTML = create_homework_div(homeworks);
        liObj.innerHTML = tempHTML;
        var ulObj = document.createElement("ul");
        ulObj.appendChild(liObj);

        $("#homework").append(ulObj);
    }

    function get_homework(course_id){
        var account = localStorage.getItem('account');
        var token = localStorage.getItem('token');
        var homework = null;
        $.ajax(
            {
                url:'proxy/get_homework.php',
                async: false,
                type: 'POST',
                dataType: 'json',
                data:{account:account,token:token,course_id:course_id},
                success : function(obj,textstatus){
                    console.log(obj);
                    code = obj.code;
                    if (code == 200){
                        homework=obj.data;
                    }else if (code==500){
                        alert("身份认证过期，请重新登录");
                        window.location.href = "login.html";
                    }
                },
                error : function(xhr){
                    console.log(xhr.responseText);
                }

            }
        )
        return homework;
    }


</script>
</html>