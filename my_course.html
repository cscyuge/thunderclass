<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的课程</title>
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="bootstrap/css/my_course.css">
    <script src="js/jquery.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="js/change_section.js"></script>
    <script src="js/vue.js"></script>
    <!-- 异步提交的库 -->
    <script src="js/vue-resource.js"></script>

    <script>
        $(function(){
            get_token();
            getId();
            show_courses();
            get_time();
        });
       function get_time(){
           var date=new Date();
           var h=date.getHours();//获取当前时间
           if(h>=0&& h<12){
            $('#time').text("大佬，早上好！");
           }else if(h>=12 && h<18){
               $('#time').text("大佬，下午好！");
           }else if(h>=18 && h<=24){
               $('#time').text("大佬 晚上好！");
           }
       }
        function get_token(){
            var token = localStorage.getItem("token");
        }

        function create_course_div(info){
            html = "";
            temp = "<div class='course_div'>";
            html+=temp;
            var info = JSON.parse(info);
            html += "<p>《"+info.title+"》</p>"+"<br>";
            var button="";
            var button = "<button onclick=\"goToClass()\">"+"开始上课"+"</button>";
            // button=button.replace(/course_id/,course.course_id);
            html += button;
            html += "<br><br>";
            html += "</div>";
            return html;
        }
        function create_course_div2(info){
            html = "";
            temp = "<div class='course_div'>";
            html+=temp;
            var info = JSON.parse(info);
            html += "<p>《"+info.title+"》</p>"+"<br>";
            var button="";
            var button = "<button onclick=\"goToClass()\">"+"开始上课"+"</button>";
            // button=button.replace(/course_id/,course.course_id);
            html += button;
            div_two="<div class='course_div_two'>";
            html+=div_two;
            var button1 = "<button onclick=\"\">"+"补充评价"+"</button>";
            html += button1;
            var button2 = "<button onclick=\"\">"+"联系老师"+"</button>";
            html += button2;
            var button3 = "<button onclick=\"\">"+"查看课程信息"+"</button>";
            html += button3;
            html += "</div>";
            html += "<br><br>";
            html += "</div>";
            return html;
        }

        function show_courses(){
            // console.log(Date.parse(new Date()));
            // console.log(localStorage.getItem("public_courses_dict"));
            var courses = localStorage.getItem("my_courses_list");
            var keyword = localStorage.getItem("my_courses_keyword");
            if (keyword){
                $("#text").attr("placeholder",keyword);
            }
            if (courses){
                //pass
            }else if (keyword){
                search_my();
                courses = localStorage.getItem("my_courses_list");
            }else{
                keyword="";
                localStorage.setItem("my_courses_keyword",keyword);
                search_my();
                courses = localStorage.getItem("my_courses_list");
            }

            courses = courses.split(",");
            var ulObj = document.createElement("ul");
            var ulObj2 = document.createElement("ul");
            for (var i=0, n=courses.length;i<n;i++){
                course = courses[i];
                console.log(course);
                var liObj = document.createElement("li");
                var liObj2 = document.createElement("li");
                tempHTML = create_course_div(course);
                tempHTML2 = create_course_div2(course);
                liObj.innerHTML = tempHTML;
                liObj2.innerHTML = tempHTML2;
                ulObj.appendChild(liObj);
                ulObj2.appendChild(liObj2);
            }
            $("#course_list1").append(ulObj2);
            $("#course_list").append(ulObj);
        }


    </script>
    <!--修改placeholder颜色，不同浏览器不同-->
    <style>
        input::-webkit-input-placeholder{
            color:#0e0e0e;
        }
        input::-moz-placeholder{   /* Mozilla Firefox 19+ */
            color:#0e0e0e;
        }
        input:-moz-placeholder{    /* Mozilla Firefox 4 to 18 */
            color:#0e0e0e;
        }
        input:-ms-input-placeholder{  /* Internet Explorer 10-11 */
            color:#0e0e0e;
        }
    </style>
</head>
<body>
<div class="top">
    <a href="info.html"><img src="images/portrait.png" class="portrait" onclick="" > </a>
    <P id="time">尊敬的用户：</P>
    <br/><br/><br/>
    <p>stay hungry,stay foolish</p>
</div>
<nav>
<ul class="one">
    <li class="special"><a href="#album">近期课程</a></li>
    <li><a href="#dynamic">课程计划信息</a></li>
</ul>
</nav>
<form id ="sea" class="sea" >
    <input class="search" type="text" name="keyword" placeholder="搜索我的课程" id="text" style="border-radius: 15px" />
    <a href="user.html"> <img type="image" src="images/search.png" id="search" onclick="search_my()" /></a>
</form>

<br/><br/>
<ul class="two">
    <li><a href="#">按学习时间顺序</a></li>
    <li><a href="#">按学科分类</a></li>
</ul>
<br/>

<section class="sys_msg" id="album">
    <div id = "course_list" >我的课程：</div>
</section>
<section  class="courses_msg" id="dynamic">
    <div id = "course_list1" >我的课程计划：</div>
</section>
<!--<div class='course_div'>
<p>课程名字</p>
    <button onclick=\"goToClass()\">"+"开始上课"+"</button>
</div>
<div class='course_div_two'>
    <button onclick=\"\">"+"查看课程信息"+"</button>
    <button onclick=\"\">"+"查看课程信息"+"</button>
    <button onclick=\"\">"+"查看课程信息"+"</button>
</div>-->
</body>
<script>
  function search_my(){
var param = new FormData(document.getElementById("sea"));
var keyword = param.get('keyword');
var account = localStorage.getItem('account');
console.log(keyword);
$.ajax(
{
   url:'proxy/search_my_courses.php',
   async: false,
   type: 'POST',
   dataType: 'json',
   data:{account:account,field:keyword},
   success : function(obj,textstatus){
   console.log(obj.data);
   localStorage.setItem("my_courses_keyword",keyword);
   localStorage.setItem("my_courses_list",obj.data.toString());
   alert(obj.data.toString());
   document.location.reload(true);
     },
  error : function(xhr){
   console.log(xhr.responseText);
   }

  }
 )
}
  function goToClass(){
      url = 'http://39.97.67.70:3000/#/zh-CN/whiteboard/guest/19c69690936011eaa55f91c00e8a23a4/';
      window.open(url, "_blank", "scrollbars=yes,resizable=1,modal=false,alwaysRaised=yes");
  }
</script>
</html>